# 单元测试文档

## 测试位置
单元测试代码位于 `src/lib.rs` 文件中，从第400行开始，使用 `#[cfg(test)] mod tests` 模块定义。

## 测试设计原理
由于WASM函数不能在非WASM环境中直接测试（会报错"cannot call wasm-bindgen imported functions on non-wasm targets"），我们创建了一个专门用于测试的 `TestGameState` 结构体，它包含了与 `IdleGame` 相同的核心逻辑，但不依赖WASM绑定。

## 测试结构

### 1. `TestGameState` 结构体
- **目的**：提供一个可在标准Rust环境中测试的游戏状态实现
- **包含字段**：
  - `coins`: 当前硬币数量
  - `coins_per_click`: 每次点击获得的硬币数
  - `coins_per_second`: 每秒自动产生的硬币数
  - `total_clicks`: 总点击次数
  - `upgrades`: 升级列表
  - `buildings`: 建筑列表

### 2. 测试函数

#### `test_initial_state()`
- **功能**：验证游戏初始化状态
- **断言**：
  - 初始硬币数量为0.0
  - 初始每次点击收益为1.0
  - 初始每秒产量为0.0

#### `test_click_action()`
- **功能**：验证点击操作的正确性
- **断言**：
  - 第一次点击后硬币数为1.0
  - 再次点击两次后硬币数为3.0

#### `test_buy_upgrade()`
- **功能**：验证升级购买逻辑
- **断言**：
  - 初始资金不足时无法购买升级
  - 充足资金后可以成功购买升级
  - 购买后硬币数量正确减少
  - 购买"Better Click"升级后每次点击收益增加

#### `test_buy_building()`
- **功能**：验证建筑购买逻辑
- **断言**：
  - 初始资金不足时无法购买建筑
  - 充足资金后可以成功购买建筑
  - 购买后硬币数量正确减少
  - 建筑数量正确增加
  - 购买建筑后每秒产量正确增加

#### `test_update_production()`
- **功能**：验证多建筑生产率计算
- **断言**：
  - 购买所有三种建筑后，总生产率正确计算为6.1
  - (Coin Mine: 0.1 + Coin Factory: 1.0 + Coin Corporation: 5.0 = 6.1)

## 测试运行方法
```bash
# 在项目根目录运行
cargo test
```

## 测试覆盖范围
- ✅ 游戏初始化状态
- ✅ 点击操作
- ✅ 升级系统
- ✅ 建筑系统
- ✅ 生产率计算

## 测试优势
1. **独立性**：不依赖WASM环境，可以在任何Rust环境中运行
2. **快速反馈**：测试执行速度快，提供即时反馈
3. **全面覆盖**：覆盖了所有核心游戏逻辑
4. **可维护性**：测试代码与实现代码紧密耦合，便于维护

这些单元测试确保了游戏核心逻辑的正确性，为后续的功能扩展提供了可靠的保障。