# Idle Game 测试用例文档

## 概述

本测试套件包含完整的端到端测试，覆盖游戏的核心功能、多语言支持、视觉效果和交互体验。所有测试都使用 Playwright 进行跨浏览器验证（Chromium、Firefox、Webkit）。

## 测试用例列表

### 1. `core-issues-fixed.test.js`
**目的**: 验证核心显示和功能问题的修复  
**验证点**:
- 中间金币显示 (`coin-display`) 正确更新（不再是始终显示 0）
- 建筑和升级列表不显示 "undefined" 文本
- 生产率显示格式正确（如 "0.1/秒" 而不是 "undefined/sec"）
- 所有用户界面文本通过 i18n 系统正确本地化

**重要性**: ⭐⭐⭐⭐⭐ (关键功能验证)

### 2. `multi-tab.test.js`  
**目的**: 验证多标签页界面的基本功能
**验证点**:
- 5个标签页存在：资源、升级、建筑、工人、设置
- 默认激活 "资源" 标签页
- 点击标签按钮能正确切换 active 状态
- 设置页面包含语言选择器和重置按钮
- 工人页面显示占位文本

**重要性**: ⭐⭐⭐⭐ (界面功能验证)

### 3. `comprehensive-tab.test.js`
**目的**: 全面验证多标签页界面与核心功能的集成
**验证点**:
- 标签页切换时内容显示/隐藏正确（CSS display 属性）
- 升级列表正确加载并显示项目
- 建筑列表正确加载并显示项目  
- 工人页面占位文本可见
- 设置页面元素（重置按钮、语言选择器）可见
- 切换回资源标签页后核心功能（点击赚取金币）正常工作

**重要性**: ⭐⭐⭐⭐⭐ (集成测试)

### 4. `debug-tab.test.js`
**目的**: 调试和诊断标签页切换问题
**验证点**:
- 记录初始状态的 CSS display 属性
- 记录切换后的 CSS display 属性
- 验证 DOM 元素的 class 属性正确更新
- 输出详细的状态信息用于问题排查

**重要性**: ⭐⭐ (调试辅助)

### 5. `visual-style.test.js`
**目的**: 验证白底黑字和 ASCII 艺术风格的视觉效果
**验证点**:
- 页面背景为白色 (`rgb(255, 255, 255)`)
- 文字颜色为黑色 (`rgb(0, 0, 0)`)
- 游戏容器有黑色边框
- 字体包含 monospace（ASCII 艺术风格）
- 资源显示使用彩色（金币-金色、木头-棕色、石头-灰色）
- 点击区域为黑色背景
- 金币显示为金色

**重要性**: ⭐⭐⭐ (用户体验验证)

### 6. `fix-all-issues.test.js`
**目的**: 综合验证所有已知问题的修复（历史测试用例）
**验证点**:
- 中间金币显示正确
- 无 undefined 值显示
- Autoclicker 功能正常产生金币
- 自动生产系统正确工作
- 多资源系统完整功能

**重要性**: ⭐⭐⭐⭐ (回归测试)

### 7. `no-undefined-display.test.js`
**目的**: 专门验证 undefined 显示问题的修复（历史测试用例）
**验证点**:
- 建筑列表不包含 "undefined" 文本
- 升级列表不包含 "undefined" 文本
- 生产率显示格式正确（正则表达式验证）
- 支持中英文两种语言格式

**重要性**: ⭐⭐⭐ (特定问题验证)

### 8. `click-after-failure.test.js`
**目的**: 验证购买失败后游戏功能的恢复（历史测试用例）
**验证点**:
- 购买失败后仍能继续点击赚取金币
- 游戏状态不会因购买失败而损坏
- UI 更新在失败后仍然正常工作

**重要性**: ⭐⭐⭐⭐ (错误处理验证)

## 测试执行策略

### 日常开发
- 运行 `core-issues-fixed.test.js` 和 `comprehensive-tab.test.js` 进行快速验证
- 这两个测试覆盖了 90% 的核心功能

### 发布前验证  
- 运行所有测试用例
- 在所有三个浏览器（Chromium、Firefox、Webkit）中执行
- 确保跨浏览器兼容性

### 问题排查
- 使用 `debug-tab.test.js` 进行详细的状态诊断
- 查看控制台输出的详细状态信息

## 测试维护指南

### 添加新测试用例
1. **命名规范**: `{功能描述}.test.js`
2. **注释要求**: 每个测试步骤都要有清晰的注释说明
3. **覆盖范围**: 优先覆盖核心功能和用户交互路径
4. **浏览器兼容**: 确保在所有目标浏览器中都能通过

### 更新现有测试
1. **向后兼容**: 保持测试接口稳定，避免破坏现有验证
2. **性能优化**: 避免过长的等待时间，使用合理的超时设置
3. **稳定性**: 使用可靠的定位器，避免脆弱的选择器

### 测试依赖
- **Playwright**: v1.58.2+
- **Node.js**: v16+ 
- **游戏服务器**: 需要运行在 http://localhost:8080

## 测试结果解读

### 通过标准
- 所有断言成功
- 无 JavaScript 错误
- UI 元素按预期显示和交互

### 常见失败原因
1. **网络问题**: 游戏服务器未启动
2. **时序问题**: 等待时间不足，需要增加 `waitForTimeout`
3. **选择器变更**: DOM 结构变化导致定位器失效
4. **浏览器差异**: 某些浏览器的渲染行为不同

### 调试技巧
1. **查看截图**: Playwright 自动生成失败时的截图
2. **检查控制台**: 查看浏览器控制台错误信息
3. **逐步执行**: 使用 `page.pause()` 进行交互式调试
4. **日志输出**: 利用 `console.log` 输出中间状态

## 版本兼容性

| 测试用例 | v0.2.0 | v0.2.1 | v0.2.2 | v0.2.3 | v0.2.4 | v0.2.5 |
|----------|--------|--------|--------|--------|--------|--------|
| core-issues-fixed.test.js | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| multi-tab.test.js | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ |
| comprehensive-tab.test.js | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| debug-tab.test.js | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| visual-style.test.js | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ |
| fix-all-issues.test.js | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ |
| no-undefined-display.test.js | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ |
| click-after-failure.test.js | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ |

✅ = 支持 | ❌ = 不支持

## 最佳实践

1. **测试先行**: 在实现新功能前先编写测试用例
2. **小步验证**: 每次提交都运行相关测试
3. **自动化集成**: 将测试集成到 CI/CD 流程中
4. **文档同步**: 保持测试文档与代码同步更新
5. **用户视角**: 从最终用户的角度设计测试场景

---

**最后更新**: 2026-02-10  
**测试版本**: v0.2.5  
**维护者**: 开发团队